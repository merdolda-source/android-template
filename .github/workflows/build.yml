name: Profesyonel APK Oluşturucu

on:
  workflow_dispatch:
    inputs:
      site_url:
        description: 'Site URL'
        required: true
      app_name:
        description: 'Uygulama Adı'
        required: true
      package_name:
        description: 'Paket Adı (örn: com.user.app1)'
        required: true
      build_id:
        description: 'Benzersiz ID'
        required: true

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: JDK 17 Kurulumu
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle

    - name: Gradle İznini Ver (Hata Çözücü)
      run: chmod +x gradlew

    - name: Parametreleri İşle
      run: |
        echo "Değişiklikler yapılıyor..."
        
        # 1. URL Değiştir
        # Dosya yolunu kesin bildiğimiz için direkt yolu veriyoruz
        sed -i 's|DEGISTIR_URL|${{ github.event.inputs.site_url }}|g' app/src/main/java/com/kodhocasi/template/MainActivity.java
        
        # 2. Uygulama Adı Değiştir
        sed -i 's|DEGISTIR_APP_ADI|${{ github.event.inputs.app_name }}|g' app/src/main/AndroidManifest.xml
        
        # 3. Paket Adı (Application ID) Değiştir - EN ÖNEMLİSİ
        # Sadece app/build.gradle içindeki applicationId kısmını değiştirir
        sed -i 's|applicationId "DEGISTIR_PACKAGE_NAME"|applicationId "${{ github.event.inputs.package_name }}"|g' app/build.gradle
        
        echo "Tüm ayarlar tamamlandı."

    - name: APK Derle (Release Modu Benzeri Debug)
      run: ./gradlew assembleDebug --stacktrace

    - name: APK Yükle
      uses: actions/upload-artifact@v4
      with:
        name: app-${{ github.event.inputs.build_id }}
        path: app/build/outputs/apk/debug/app-debug.apk
