name: APK Oluşturucu

on:
  workflow_dispatch:
    inputs:
      site_url:
        description: 'Uygulama Site URL'
        required: true
      app_name:
        description: 'Uygulama Adı'
        required: true
      user_id:
        description: 'Kullanıcı ID (Dosya ismi için)'
        required: true

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: JDK Kurulumu
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: gradle

    - name: URL ve İsim Değiştirme (Sihirli Kısım)
      run: |
        # Java dosyasındaki URL'yi değiştir
        sed -i 's|DEGISTIR_URL|${{ github.event.inputs.site_url }}|g' app/src/main/java/com/ornek/webviewapp/MainActivity.java
        
        # Manifest dosyasındaki Uygulama Adını değiştir
        sed -i 's|DEGISTIR_APP_ADI|${{ github.event.inputs.app_name }}|g' app/src/main/AndroidManifest.xml

    - name: APK Derleme (Build)
      run: ./gradlew assembleDebug

    - name: APK'yı Yükle (Artifact)
      uses: actions/upload-artifact@v4
      with:
        name: app-${{ github.event.inputs.user_id }}
        path: app/build/outputs/apk/debug/app-debug.apk
